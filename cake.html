<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Magical Birthday Cake</title>
  <style>
    /* (styles unchanged from your original, trimmed here for brevity) */
    /* Global Styles */
    * { margin:0; padding:0; box-sizing:border-box; font-family:"Arial Rounded MT Bold", "Helvetica Rounded", Arial, sans-serif; }
    body { background: linear-gradient(135deg,#ffcce6,#c4e0ff); min-height:100vh; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative; }
    .balloon{ position:absolute; width:40px; height:50px; border-radius:50%; animation:float 15s infinite ease-in-out; z-index:1; }
    @keyframes float { 0%{ transform:translateY(100vh) translateX(0); opacity:1 } 100%{ transform:translateY(-100px) translateX(50px); opacity:0 } }
    .confetti{ position:absolute; width:10px; height:10px; background-color:#ffcc00; opacity:0; animation:confettiFall 5s infinite ease-out; z-index:1; }
    @keyframes confettiFall { 0%{ transform:translateY(-10vh) rotate(0deg); opacity:1 } 100%{ transform:translateY(100vh) rotate(720deg); opacity:0 } }

    .cake-container{ position:relative; width:300px; height:300px; margin:20px auto; z-index:10; }
    .cake{ position:absolute; bottom:0; left:50%; transform:translateX(-50%); width:200px; height:120px; background:linear-gradient(to right,#ff85a2,#ff99b6); border-radius:10px 10px 0 0; box-shadow:0 5px 15px rgba(0,0,0,0.2); }
    .cake:before{ content:""; position:absolute; top:-40px; left:0; width:100%; height:40px; background:linear-gradient(to right,#fc6c85,#ff85a2); border-radius:10px 10px 0 0; }
    .cake:after{ content:""; position:absolute; top:-70px; left:10%; width:80%; height:30px; background:linear-gradient(to right,#ffb3c6,#ffcce6); border-radius:10px 10px 0 0; }

    .frosting{ position:absolute; top:-75px; left:15%; width:70%; height:5px; background:#fff; border-radius:5px; box-shadow:0 0 5px #ffcce6; }
    .decoration{ position:absolute; width:10px; height:10px; border-radius:50%; background:#ff3366; box-shadow:0 0 5px #ff99b6; }

    .candle-container{ position:absolute; top:-95px; left:0; width:100%; display:flex; justify-content:center; gap:20px; z-index:15; }
    .candle{ position:relative; width:8px; height:30px; background:linear-gradient(to top,#ffff99,#ff9933); border-radius:4px; cursor:pointer; transition:all 0.3s ease; }
    .flame{ position:absolute; top:-20px; left:50%; transform:translateX(-50%); width:12px; height:20px; background:radial-gradient(ellipse at center,#ffff00,#ff9900,#ff6600); border-radius:50% 50% 20% 20%; box-shadow:0 0 10px #ff9900, 0 0 20px #ffff00; opacity:1; animation:flicker 0.5s infinite alternate; z-index:20; }
    @keyframes flicker { 0%{ transform:translateX(-50%) scale(1); opacity:1 } 100%{ transform:translateX(-50%) scale(1.1); opacity:0.9 } }
    .candle.blown .flame { opacity:0; animation:none; transition:opacity .3s ease-out; }
    .smoke{ position:absolute; top:-25px; left:50%; transform:translateX(-50%); width:8px; height:0; background:rgba(200,200,200,0.5); border-radius:10px; opacity:0; transition:all .5s ease; }
    .candle.blown .smoke{ height:30px; opacity:0.7; animation:smokeRise 2s forwards; }
    @keyframes smokeRise { 0%{ height:0; opacity:0 } 20%{ height:10px; opacity:0.7 } 100%{ height:30px; opacity:0; transform:translateX(-50%) translateY(-30px) scale(1.5) } }

    .sparkle{ position:absolute; width:4px; height:4px; background-color:#fff; border-radius:50%; box-shadow:0 0 5px #ffff99; opacity:0; z-index:12; }
    @keyframes sparkle { 0%{ transform:scale(0) rotate(0deg); opacity:0 } 50%{ opacity:1 } 100%{ transform:scale(1.5) rotate(90deg); opacity:0 } }

    .wish-message{ position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(0); background:rgba(255,255,255,0.95); padding:25px; border-radius:20px; box-shadow:0 10px 30px rgba(255,105,180,0.8), 0 0 20px rgba(255,255,255,0.8); text-align:center; z-index:100; opacity:0; width:90%; max-width:400px; transition:all .5s ease; border:3px solid rgba(255,255,255,0.7); }
    .wish-message.show{ transform:translate(-50%,-50%) scale(1); opacity:1; animation:bounceIn .8s; }
    @keyframes bounceIn { 0%{ transform:translate(-50%,-50%) scale(0); opacity:0 } 60%{ transform:translate(-50%,-50%) scale(1.1); opacity:1 } 100%{ transform:translate(-50%,-50%) scale(1); opacity:1 } }
    .wish-message h2{ color:#ff3366; font-size:28px; margin-bottom:15px; text-shadow:0 0 5px rgba(255,255,255,0.7); background:linear-gradient(45deg,#ff3366,#ff66b3); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
    .wish-message p{ color:#333; font-size:20px; margin-bottom:20px; line-height:1.5; font-weight:500; }

    .firework{ position:absolute; width:5px; height:5px; border-radius:50%; opacity:0; z-index:5; }
    @keyframes firework { 0%{ transform:scale(0); opacity:1; box-shadow:0 0 0 0 rgba(255,255,255,0.9) } 100%{ transform:scale(1); opacity:0; box-shadow:0 0 0 50px rgba(255,255,255,0) } }

    .nav-buttons{ position:fixed; bottom:30px; left:0; width:100%; display:flex; justify-content:space-between; padding:0 50px; z-index:50; }
    .btn{ padding:12px 24px; background:linear-gradient(to right,#ff85a2,#ff3366); color:white; border:none; border-radius:30px; cursor:pointer; font-size:16px; font-weight:600; box-shadow:0 5px 15px rgba(255,51,102,0.4); transition:all .3s ease; outline:none; }
    .btn:hover{ transform:translateY(-3px); box-shadow:0 8px 20px rgba(255,51,102,0.6); }
    .btn:active{ transform:translateY(-1px); box-shadow:0 5px 10px rgba(255,51,102,0.4); }

    /* Responsive (kept as before) */
    @media (max-width:768px){ .cake-container{ width:250px;height:250px } .cake{ width:160px;height:90px } .candle-container{ gap:15px } .wish-message h2{ font-size:24px } .wish-message p{ font-size:18px } .nav-buttons{ padding:0 20px; bottom:20px } .btn{ padding:10px 18px; font-size:15px } }
    @media (max-width:480px){ .cake-container{ width:200px;height:200px } .cake{ width:130px;height:80px } .candle-container{ gap:12px; top:-85px } .candle{ width:6px;height:25px } .wish-message{ width:85%; padding:20px } .wish-message h2{ font-size:22px } .wish-message p{ font-size:16px } .nav-buttons{ padding:0 15px; bottom:15px } .btn{ padding:8px 14px; font-size:14px; white-space:nowrap } }
    @media (max-width:360px){ .cake-container{ width:180px;height:180px } .cake{ width:110px;height:70px } .candle-container{ gap:10px } .wish-message{ width:90%; padding:15px } .wish-message h2{ font-size:20px } .wish-message p{ font-size:14px } .nav-buttons{ flex-direction:column; align-items:center; gap:10px } .btn{ width:100%; text-align:center; font-size:13px } }
  </style>
</head>
<body>
  <!-- Cake -->
  <div class="cake-container" id="cakeContainer">
    <div class="cake">
      <div class="candle-container" id="candleContainer"></div>
      <div class="frosting"></div>
      <!-- decorations will be injected -->
    </div>
  </div>

  <!-- Wish -->
  <div class="wish-message" id="wishMessage" role="dialog" aria-modal="true" aria-hidden="true">
    <h2>‚ú® Happy Birthday! ‚ú®</h2>
    <p>Make a wish, Bestie! May all your dreams come true! üéÇ‚ú®</p>
    <button class="btn" id="closeWishBtn">Thank you! ‚ù§Ô∏è</button>
  </div>

  <div class="nav-buttons">
    <button class="btn" onclick="location.href='memorylane.html'">‚óÄ Back to Memory Lane</button>
    <button class="btn" onclick="location.href='letter.html'">Next Surprise ‚ñ∂</button>
  </div>

  <script>
    // small improvements & defensive checks
    let candlesBlown = 0;
    const totalCandles = 5;
    let allCandlesBlown = false;

    document.addEventListener('DOMContentLoaded', () => {
      createCandles();
      createBalloons();
      createConfetti();
      createDecorations();

      // click to blow - only on click/touch to avoid accidental hover triggers
      document.getElementById('candleContainer').addEventListener('click', (e) => {
        const candle = e.target.closest('.candle');
        if (candle && !candle.classList.contains('blown')) blowOutCandle.call(candle);
      });

      // keyboard shortcut: B (blow a random candle) ‚Äî accessible enhancement
      document.addEventListener('keydown', (e) => {
        if (e.key === 'b' || e.key === 'B') blowRandomCandle();
      });

      document.getElementById('closeWishBtn').addEventListener('click', closeWishMessage);
    });

    // Create only the number of missing candles (prevents duplicates)
    function createCandles() {
      const container = document.getElementById('candleContainer');
      const existing = container.querySelectorAll('.candle').length;
      const toCreate = Math.max(0, totalCandles - existing);
      for (let i = 0; i < toCreate; i++) {
        const candle = document.createElement('div');
        candle.className = 'candle';
        candle.setAttribute('role','button');
        candle.setAttribute('tabindex','0');
        candle.setAttribute('aria-label','Candle: click to blow');

        const flame = document.createElement('div'); flame.className='flame';
        const smoke = document.createElement('div'); smoke.className='smoke';
        candle.appendChild(flame);
        candle.appendChild(smoke);

        // keyboard support
        candle.addEventListener('keydown', function(e){ if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); blowOutCandle.call(this); } });

        container.appendChild(candle);
      }
    }

    function createBalloons() {
      const colors = ['#ff66b3','#66ccff','#ff9966','#99ff66','#cc99ff'];
      const numBalloons = 12;
      for (let i=0;i<numBalloons;i++){
        const balloon=document.createElement('div');
        balloon.className='balloon';
        balloon.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
        balloon.style.left = (Math.random()*100)+'%';
        balloon.style.animationDuration = `${15 + Math.random()*10}s`;
        balloon.style.animationDelay = `${Math.random()*5}s`;
        document.body.appendChild(balloon);
      }
    }

    function createConfetti(){
      const colors = ['#ffcc00','#ff66b3','#66ccff','#ff9966','#99ff66'];
      const numConfetti = 40;
      for (let i=0;i<numConfetti;i++){
        const confetti = document.createElement('div');
        confetti.className='confetti';
        confetti.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
        confetti.style.left = (Math.random()*100)+'%';
        confetti.style.width = `${5 + Math.random()*5}px`;
        confetti.style.height = `${5 + Math.random()*10}px`;
        confetti.style.animationDuration = `${3 + Math.random()*4}s`;
        confetti.style.animationDelay = `${Math.random()*5}s`;
        document.body.appendChild(confetti);
      }
    }

    function createDecorations(){
      const cake = document.querySelector('.cake');
      const colors = ['#ff3366','#ffcc00','#66ccff','#ff9966','#99ff66'];
      const numDecorations = 10;
      for (let i=0;i<numDecorations;i++){
        const dec = document.createElement('div');
        dec.className='decoration';
        dec.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
        dec.style.top = `${-20 - Math.random()*50}px`;
        dec.style.left = `${Math.random()*100}%`;
        cake.appendChild(dec);
      }
    }

    function blowOutCandle(){
      if (this.classList.contains('blown')) return;
      this.classList.add('blown');
      candlesBlown++;
      createSparkleEffect(this);
      const flame = this.querySelector('.flame');
      if (flame) flame.setAttribute('aria-hidden','true');

      if (candlesBlown === totalCandles && !allCandlesBlown){
        allCandlesBlown = true;
        setTimeout(showWishMessage, 800);
      }
    }

    function blowRandomCandle(){
      const unblown = Array.from(document.querySelectorAll('.candle:not(.blown)'));
      if (!unblown.length) return;
      const rand = unblown[Math.floor(Math.random()*unblown.length)];
      blowOutCandle.call(rand);
    }

    function createSparkleEffect(candle){
      const numSparkles = 8;
      const rect = candle.getBoundingClientRect();
      for (let i=0;i<numSparkles;i++){
        const sp = document.createElement('div');
        sp.className='sparkle';
        sp.style.left = `${rect.left + Math.random()*rect.width}px`;
        sp.style.top = `${rect.top + Math.random()*(rect.height/2)}px`;
        sp.style.animation = `sparkle ${0.5 + Math.random()*0.5}s forwards`;
        document.body.appendChild(sp);
        setTimeout(()=> sp.remove(), 1200);
      }
    }

    function showWishMessage(){
      const el = document.getElementById('wishMessage');
      el.classList.add('show');
      el.setAttribute('aria-hidden','false');
      createFireworks();
    }

    function closeWishMessage(){
      const el = document.getElementById('wishMessage');
      el.classList.remove('show');
      el.setAttribute('aria-hidden','true');
    }

    function createFireworks(){
      const num = 8;
      const colors = ['#ff3366','#ffcc00','#66ccff','#ff9966','#99ff66'];
      for (let i=0;i<num;i++){
        setTimeout(()=>{
          const fw = document.createElement('div');
          fw.className='firework';
          fw.style.left = `${10 + Math.random()*80}%`;
          fw.style.top = `${10 + Math.random()*60}%`;
          fw.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
          fw.style.animation = `firework ${1 + Math.random()}s forwards`;
          document.body.appendChild(fw);
          setTimeout(()=>fw.remove(), 2000);
        }, i*250);
      }
    }
  </script>
</body>
</html>
